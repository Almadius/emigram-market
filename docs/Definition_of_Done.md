# Definition of Done (DoD) — EMIGRAM MARKET (v1.0)

Этот документ нужен, чтобы на вопрос “по ТЗ всё готово?” был проверяемый ответ.

## 1) DoD на уровне продукта (функциональный)

- **Pricing**: пользователь видит Emigram price + зачеркнутую store price + экономию (€ и %) в каталоге и карточке товара.
- **Price resolve API**: `POST /api/v1/price/resolve` возвращает расчет + правила/разбивку скидок.
- **Cart**: корзина поддерживает товары из разных магазинов.
- **Orders**: оформление заказа работает; заказ появляется в списке заказов пользователя; статусы меняются/логируются.
- **Split**: выбран и реализован формат split (1 заказ на магазин либо suborders в одном заказе) и он покрыт тестами.
- **Installment**: расчет рассрочки доступен и зависит от user level; Stripe интеграция определена и протестирована “на моках”.
- **AI**: чат и поиск аналогов работают стабильно (есть обработка ошибок провайдера).
- **Admin**: админ может управлять Shops/Products/DiscountRules/PriceSnapshots/Orders; может задавать parsing selectors.

## 2) DoD на уровне данных/хранилищ

- **PostgreSQL**: миграции применяются без ошибок.
- **Redis/Queues**: тяжелые задачи выполняются в очереди (crawler/agent/sync).
- **PriceSnapshots**: сохраняются все источники цен (extension/webview/crawler) с `parsed_at`.

## 3) DoD на уровне качества

- **Тесты**: unit + feature + integration проходят.
- **Покрытие**: зафиксирован целевой порог (например 80%) и он проверяется в CI/скриптом.
- **Логи/метрики**: ключевые бизнес-события логируются (price resolve, order created, shop order failed, crawler failures).
- **Performance**: определены endpoint’ы и сценарии для SLA ≤200мс (в тестовом окружении) и есть мониторинг медленных запросов.

## 4) DoD на уровне безопасности/легальности (минимальный)

- **Auth**: API защищен токенами (Sanctum).
- **PCI**: платежные данные карт не хранятся и обрабатываются Stripe.
- **GDPR**: определены категории персональных данных, сроки хранения логов/снапшотов, механизм удаления/экспорта (или явно “вне scope v1.0”).
- **Crawler**: соблюдаются rate limits; документирована стратегия “уважительного” парсинга.

## 5) Примечание по двусмысленностям ТЗ

Перед тем как объявлять “готово по ТЗ”, должны быть явно утверждены:
- Формула pricing (в ТЗ встречаются 2 разных формулировки).
- Правило `Price_final` (строго `min()` или “приоритет источников”).
- Роль Aimeos (ядро сейчас или этап 3).
- Модель “agent без партнерства” (автоматизация или semi-automated).




